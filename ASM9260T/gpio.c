#include "usrinc.h"
#include "ASM9260T.h"

////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////
//|          |
//| 函数名称 |: HW_GpioInit
//| 功能描述 |: 与HW_PinMuxInit()函数功能一致，都是使能模块的时钟。
//|          |:
//| 参数列表 |:
//|          |:
//| 返    回 |:
//|          |:
//| 备注信息 |:
//|          |:
////////////////////////////////////////////////////////////////////////////////
bool_t HW_GpioInit(void)
{
  outl(((1<<25)|(1<<4)), REG_SET(HW_AHBCLKCTRL0));  // IOCONFIG,GPIO模块时钟使能
  return TRUE;
}

////////////////////////////////////////////////////////////////////////////////
//|          |
//| 函数名称 |: 
//| 功能描述 |:
//|          |:
//| 参数列表 |:
//|          |:
//| 返    回 |:
//|          |:
//| 备注信息 |:
//|          |:
////////////////////////////////////////////////////////////////////////////////
void HW_GpioSetDir(u32_t port, u32_t pin, bool_t bOut)
{
  u32_t addr, val;
  addr = (HW_GPIO_DATA_BASE+0x8000+(port/4)*0x10000);
  if(bOut){
    addr = REG_SET(addr);
  }else{
    addr = REG_CLR(addr);
  }
  val = (1 << ((port%4)*8+pin));
  outl(val, addr);
}

////////////////////////////////////////////////////////////////////////////////
//|          |
//| 函数名称 |: 
//| 功能描述 |:
//|          |:
//| 参数列表 |:
//|          |:
//| 返    回 |:
//|          |:
//| 备注信息 |:
//|          |:
////////////////////////////////////////////////////////////////////////////////
void HW_GpioSetVal(u32_t port, u32_t pin)
{
  u32_t addr, val;
  addr = REG_SET(HW_GPIO_DATA_BASE+(port/4)*0x10000);
  val  = (1 << ((port%4)*8+pin));
  outl(val, addr);
}

////////////////////////////////////////////////////////////////////////////////
//|          |
//| 函数名称 |: 
//| 功能描述 |:
//|          |:
//| 参数列表 |:
//|          |:
//| 返    回 |:
//|          |:
//| 备注信息 |:
//|          |:
////////////////////////////////////////////////////////////////////////////////
void HW_GpioClrVal(u32_t port, u32_t pin)
{
  u32_t addr, val;
  addr = REG_CLR(HW_GPIO_DATA_BASE+(port/4)*0x10000);
  val  = (1 << ((port%4)*8+pin));
  outl(val, addr);
}

////////////////////////////////////////////////////////////////////////////////
//|          |
//| 函数名称 |: 
//| 功能描述 |:
//|          |:
//| 参数列表 |:
//|          |:
//| 返    回 |:
//|          |:
//| 备注信息 |:
//|          |:
////////////////////////////////////////////////////////////////////////////////
void HW_GpioToggle(u32_t port, u32_t pin)
{
  u32_t addr, val;
  addr = REG_TOG(HW_GPIO_DATA_BASE+(port/4)*0x10000);
  val  = (1 << ((port%4)*8+pin));
  outl(val, addr);
}

////////////////////////////////////////////////////////////////////////////////
//|          |
//| 函数名称 |: 
//| 功能描述 |:
//|          |:
//| 参数列表 |:
//|          |:
//| 返    回 |:
//|          |:
//| 备注信息 |:
//|          |:
////////////////////////////////////////////////////////////////////////////////
int HW_GpioReadPin(u32_t port, u32_t pin)
{
  u32_t r = (HW_GpioReadPort(port)>>pin);
  return (r & 1);
}

////////////////////////////////////////////////////////////////////////////////
//|          |
//| 函数名称 |: 
//| 功能描述 |:
//|          |:
//| 参数列表 |:
//|          |:
//| 返    回 |:
//|          |:
//| 备注信息 |:
//|          |:
////////////////////////////////////////////////////////////////////////////////
void HW_GpioWritePort(u32_t port, u32_t msk, u32_t val)
{
  u32_t addr, shift;
  addr  = (HW_GPIO_DATA_BASE+(port/4)*0x10000);
  shift = ((port%4)*8);
  msk   = ((msk&0xFF)<<shift);
  val   = ((val&0xFF)<<shift);
  outl((msk&(~val)), REG_CLR(addr));
  outl((msk&val), REG_SET(addr));
}

////////////////////////////////////////////////////////////////////////////////
//|          |
//| 函数名称 |: 
//| 功能描述 |:
//|          |:
//| 参数列表 |:
//|          |:
//| 返    回 |:
//|          |:
//| 备注信息 |:
//|          |:
////////////////////////////////////////////////////////////////////////////////
u8_t HW_GpioReadPort(u32_t port)
{
  u32_t addr, shift;
  addr  = (HW_GPIO_DATA_BASE+(port/4)*0x10000);
  shift = ((port%4)*8);
  return (u8_t)(inl(addr)>>shift);
}
